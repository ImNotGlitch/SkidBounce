/*
 * SkidBounce Hacked Client
 * A free open source mixin-based injection hacked client for Minecraft using Minecraft Forge, Forked from LiquidBounce.
 * https://github.com/ManInMyVan/SkidBounce/
 */
package net.ccbluex.liquidbounce.features.module.modules.exploit

import net.ccbluex.liquidbounce.event.*
import net.ccbluex.liquidbounce.features.module.*
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.DisablerMode
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.grim.*
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.other.*
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.vulcan.*
import net.ccbluex.liquidbounce.utils.ClientUtils
import net.ccbluex.liquidbounce.value.*

object Disabler : Module("Disabler", ModuleCategory.EXPLOIT) {
    private val debug = BoolValue("Debug", false)
    var settings: List<Value<*>> = arrayListOf(debug)
    private val modes = arrayOf(
        NoTransaction,
        NoKeepAlive,
        NoSwing,
        NoEntityAction,
        NoAbilities,
        NoDigging,
        NoFlying,
        VulcanAutoBlock,
        GrimFastBreak,
        GrimPlace,
        StormMovement,
        VerusReachB,
        Riding,
    ).run {
        sortedBy { it.modeName }
            .onEach { mode ->
                settings += object: BoolValue(mode.modeName, false) {
                    override fun onChange(oldValue: Boolean, newValue: Boolean): Boolean {
                        if (state && newValue && !oldValue) mode.onEnable()
                        if (state && !newValue && oldValue) mode.onDisable()
                        return newValue
                    }
                }
                mode.settings.onEach { settings += it }
            }
        this
    }

    override fun onEnable() { activeModes.onEach { it.onEnable() } }
    override fun onDisable() { activeModes.onEach { it.onDisable() } }

    @EventTarget(priority = 2)
    fun onPacket(event: PacketEvent) { activeModes.onEach { it.onPacket(event) } }
    @EventTarget
    fun onUpdate() { activeModes.onEach { it.onUpdate() } }
    @EventTarget
    fun onMove(event: MoveEvent) { activeModes.onEach { it.onMove(event) } }
    @EventTarget
    fun onMotion(event: MotionEvent) { activeModes.onEach { it.onMotion(event) } }

    private val activeModes: List<DisablerMode>
        get() = modes.filter { mode ->
                values.find { mode.modeName == it.name }!!.get() as Boolean
            }

    val DisablerMode.active
        get() = activeModes.contains(this)

    override val values: List<Value<*>>
        get() = settings

    fun debug(message: String) {
        if (debug.get())
            ClientUtils.displayChatMessage("§7[§cDebug§7]§r $message")
    }
}
